asl.options(null);asl.title("Login");asl.back(null);asl.events.subscribe(asl.events.types.exit,function(){asl.badge(null);"function"==typeof asl.lock&&asl.lock(null)});var username=null,newUser;document.getElementById("txt_username").onchange=function(a){requestUser(this.value)};
function requestUser(a){username=a;a="php/db/get_user.php?login="+username;username?ajaxRequest("GET",a,function(a){try{var b=JSON.parse(a);if(!b)throw"No hubo respuesta del servidor.";"success"==b.status?(newUser=new User(b.data),0<productos.length&&user&&user.ID!=newUser.ID?confirm("Existe una prenota del usuario "+user.Name+", si inicias sesi\u00f3n se borrar\u00e1 la prenota. \u00bfContinuar?",function(a){a&&deleteLastPrenote()}):login()):alert(b.data)}catch(c){alert(a)}}):alert("Ingresa un usuario.")}
function login(){asl.badge(cfg.badge);"function"==typeof asl.lock&&asl.lock(cfg.badge);window.localStorage.setItem("user",JSON.stringify(newUser));window.location="scan_product.html"}function deleteLastPrenote(){window.localStorage.removeItem("products");window.localStorage.removeItem("bhasName");window.localStorage.removeItem("sclientName");productos.length=0;login()};