var CombinationList={list:null,pagingTop:null,pagingBottom:null,pagingText:null,aCombination:[],pagingInfo:{currentPage:0,totalCount:0,perPage:cfg.itemsPerPage},init:function(){this.list=document.getElementById("list");this.pagingTop=document.getElementById("paging_top");this.pagingBottom=document.getElementById("paging_bottom");this.pagingText=document.getElementById("paging_text");this.pagingTop.onclick=function(){"disabled"!=this.className&&CombinationList.show(CombinationList.pagingInfo.currentPage-
1)};this.pagingBottom.onclick=function(){"disabled"!=this.className&&CombinationList.show(CombinationList.pagingInfo.currentPage+1)};for(j=0;j<this.pagingInfo.perPage;j++)this.list.children[j].onclick=this.selectCombination;var c=JSON.parse(window.localStorage.getItem("optionListNum")),a=JSON.parse(window.localStorage.getItem("product"));asl.title(a.options[c].name);this.requestOptionList(a.ID,a.options[c].optionID,a.options[c].optionListID)},requestOptionList:function(c,a,b){var d=window.localStorage.getItem("aOptionDetail");
ajaxRequest("GET","php/db/get_item_option_list.php?optionID="+a+"&itemId="+c+"&aOptionDetails="+d+"&optionListID="+b,function(a){try{var b=JSON.parse(a);if(b){var c=JSON.parse(window.localStorage.getItem("product")),d=JSON.parse(window.localStorage.getItem("optionListNum"));0==c.options[d].mandatory&&b.push({id:0,name:"Omitir",externalID:"",quantity:""});CombinationList.aCombination=b}CombinationList.show(0)}catch(f){alert(a)}})},show:function(c){var a=CombinationList.aCombination;this.pagingInfo.currentPage=
c;this.pagingInfo.totalCount=0<a.length?a.length:1;this.pagingText.innerText=c+1+"/"+Math.ceil(this.pagingInfo.totalCount/this.pagingInfo.perPage);for(var b=0,d=a.length-1-c*this.pagingInfo.perPage;0<=d&&b<this.pagingInfo.perPage;d--,b++)this.list.children[b].children[0].children[0].innerHTML=a[d].name,this.list.children[b].children[0].children[1].children[0].innerHTML=a[d].externalID,this.list.children[b].id=a[d].id,this.list.children[b].externalID=a[d].externalID,this.list.children[b].children[0].children[1].children[1].innerHTML=
a[d].id?parseInt(a[d].quantity)||0:"",this.list.children[b].style.setProperty("visibility","visible");if(b<this.pagingInfo.perPage)for(b;b<this.pagingInfo.perPage;b++)this.list.children[b].children[0].children[0].innerHTML="Empty",this.list.children[b].style.setProperty("visibility","hidden");this.pagingBottom.className=c+1==Math.ceil(this.pagingInfo.totalCount/this.pagingInfo.perPage)?"disabled":"enabled";this.pagingTop.className=0==c?"disabled":"enabled"},selectCombination:function(c){var a=parseInt(c.currentTarget.id);
c=c.currentTarget.externalID;var b=JSON.parse(window.localStorage.getItem("optionListNum")),d=JSON.parse(window.localStorage.getItem("product"));if(a){var e=JSON.parse(window.localStorage.getItem("aOptionDetail"));e.push(a);window.localStorage.setItem("aOptionDetail",JSON.stringify(e));a=JSON.parse(window.localStorage.getItem("combExternalID"));null==a&&(a="");window.localStorage.setItem("combExternalID",JSON.stringify(a+c))}b+1<d.options.length?(window.localStorage.setItem("optionListNum",JSON.stringify(b+
1)),window.location="combination_list.html"):window.location="scan_product.html"}};function backToProducts(){window.localStorage.removeItem("aOptionDetail");window.localStorage.removeItem("combExternalID");window.location="scan_product.html"}asl.options(null);asl.back(backToProducts);asl.events.subscribe(asl.events.types.exit,function(){asl.badge(null);"function"==typeof asl.lock&&asl.lock(null)});asl.events.subscribe(asl.events.types.loaded,function(){CombinationList.init()});